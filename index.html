<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customers</title>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <link href="index.css" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>


<body>

  <div style="color:whitesmoke;">
    <nav class="navbar navbar-dark bg-mynav">
      <divclass="container-fluid">
        <aclass="navbar-brand" href="#">Danielle App<table></table></a>
  </div>
  </nav>
  </div>



  <div class="container">
    <div class="d-flex bd-highlight mb-3">
      <div class="me-auto p-2 bd-highlight">
        <h1>Customers</h1>
      </div>
      <div class="p-2 bd-highlight">
        <!-- <button type="button" class="btn btn-secondary" onclick="showUserCreateBox()">Create</button> -->
      </div>
    </div>

    <div id="add-form">
      <h3>Add Record</h3>
      <form id="create-item-form">
        <label for="add-name">Name:</label>
        <br>
        <input type="text" id="add-name" name="add-name" size="100" />
        <br>

        <label for="add-Email">Email:</label>
        <br>
        <input type="text" id="add-Email" name="add-Email" size="100" />
        <br>
        <label for="add-Address">Address:</label>
        <br>
        <input type="text" id="add-Address" name="add-Address" size="100" />
        <br>
        <label for="add-Phone">Phone:</label>
        <br>
        <input type="number" id="add-Phone" name="add-Phone" size="100" />
        <br>
        <br>
        <label for="add-Image">Image:</label>
        <input type="file" name="add-Image" id="image">
        <br>

        <input type="submit" value="Create">

      </form>
    </div>
    <br>



    <div class="table-responsive">
      <table class="table" id="data-table">
        <thead>
          <tr>
            <th scope="col">id</th>
            <th scope="col">Name</th>
            <th scope="col">Phone</th>
            <th scope="col">Email</th>
            <th scope="col">Address</th>
            <th scope="col">Image</th>
            <th scope="col">Edit</th>
            <th scope="col">Delete</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>



      <div id="edit-form" style="display:none;">
        <h2>Edit Record</h2>
        <form id="edit-item-form">
          <input type="hidden" id="edit-id" name="id" />
          <label for="edit-name">Name:</label>
          <input type="text" id="edit-name" name="name" />
          <br>
          <label for="edit-Phone">Phone:</label>
          <input type="number" id="edit-Phone" name="Phone" />
          <br>
          <label for="edit-Email">Email:</label>
          <input type="text" id="edit-Email" name="Email" />
          <br>
          <label for="edit-Address">Address:</label>
          <input type="text" id="edit-Address" name="Address" />
          <br>
          <label for="edit-image">Image:</label>
          <input type="file" id="edit-image" name="image" />
          <br>
          <input type="submit" value="Save">
          <button type="button" id="edit-cancel"  onclick="HideEditForm()">Cancel</button>
        </form>
      </div>

    </div>




    <script>

      const MY_SERVER = 'http://127.0.0.1:8000/customers/'
      const SERVER = 'http://127.0.0.1:8000'

      //////LOAD DATA/////////////////////////////
      
      const load_data = async () => {
        const res = await axios.get(MY_SERVER).then(response => {
          const tableBody = document.querySelector('#data-table tbody');
          response.data.forEach(item => {
            const newRow = tableBody.insertRow();

            const IdCell = newRow.insertCell();
            const NameCell = newRow.insertCell();
            const PhoneCell = newRow.insertCell();
            const EmailCell = newRow.insertCell();
            const AddressCell = newRow.insertCell();
            const imageCell = newRow.insertCell();
            const editCell = newRow.insertCell();
            const deleteCell = newRow.insertCell();

            IdCell.innerHTML = item.id;
            NameCell.innerHTML = item.Name;
            PhoneCell.innerHTML = item.Phone;
            EmailCell.innerHTML = item.Email;
            AddressCell.innerHTML = item.Address;
            imageCell.innerHTML = `<img width=100px high=70px src='${SERVER + item.image}'>`;
            editCell.innerHTML = `<button style="background-color: rgb(5, 171, 85); color: aliceblue; border-radius: 4px; border: none; width:80px" data-id="${item.id}" class="edit-button">Edit</button>`;
            deleteCell.innerHTML = `<button style="background-color: red; color: aliceblue; border-radius: 4px; border: none; width:80px"  data-id="${item.id}" class="delete-button">Delete</button>`;


          });


          /////////////////////EDIT DATA////////////////////////////////////////////////////////////////////////////////////////////////////


          // Attach event listener to Edit button
          const editButtons = document.querySelectorAll('.edit-button');
          editButtons.forEach(button => {
            button.addEventListener('click', event => {
              const id = event.target.dataset.id;
              // Get record data from server and display edit form
              axios.get(MY_SERVER + id)
                .then(response => {
                  const record = response.data;
                  const form = document.querySelector('#edit-form');
                  form.style.display = 'block';
                  form.querySelector('#edit-id').value = record.id;
                  form.querySelector('#edit-name').value = record.Name;
                  form.querySelector('#edit-Phone').value = record.Phone;
                  form.querySelector('#edit-Email').value = record.Email;
                  form.querySelector('#edit-Address').value = record.Address;
                  form.querySelector('#edit-image').value = record.image;
                })

            });
          });


          // Attach event listener to Edit form submit button
          const editItemForm = document.getElementById('edit-item-form');
          const form = document.querySelector('#edit-form');
          editItemForm.addEventListener('submit', (event) => {


            event.preventDefault();
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('edit-name').value;
            const Phone = document.getElementById('edit-Phone').value;
            const Email = document.getElementById('edit-Email').value;
            const Address = document.getElementById('edit-Address').value;
            const image = document.getElementById('edit-image').files[0];
            // Send PUT request to server with updated record data

            const formData = new FormData();
            formData.append('Name', name);
            formData.append('Phone', Phone);
            formData.append('Email', Email);
            formData.append('Address', Address);
            formData.append('image',image);


            axios.put(MY_SERVER + id, formData, {
              headers: {
                'Content-Type': 'multipart/form-data'
              }
            })
              .then(response => {
                console.log(response.data);
                //alert('Item updated!');
                form.style.display = 'none';

              })
              .catch(error => {
                console.error(error);
                //alert('Item update failed.');
              });

          });

         









          ////////////////DELETE RECORD////////////////////////////////////////////////////////////////////////////////////////////////////////////
          // Attach event listener to Delete button
          const deleteButtons = document.querySelectorAll('.delete-button');
          deleteButtons.forEach(button => {
            button.addEventListener('click', event => {
              const id = event.target.dataset.id;
              axios.delete(MY_SERVER + id)
                .then(response => {
                  console.log('Item deleted:', response.data);
                  // Remove row from table
                  const row = event.target.parentNode.parentNode;
                  row.parentNode.removeChild(row);
                })
              // Send DELETE request to server with ID
            });
          });

          ////////////////////ADD NEW RECORD/////////////////////////////////////////////////////////////////////////////////////////////////////
          const createItemForm = document.getElementById('create-item-form');
          createItemForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const name = document.getElementById('add-name').value;
            const Phone = document.getElementById('add-Phone').value;
            const Email = document.getElementById('add-Email').value;
            const Address = document.getElementById('add-Address').value;
            const image = document.getElementById('image').files[0];

            const formData = new FormData();
            formData.append('Name', name);
            formData.append('Phone', Phone);
            formData.append('Email', Email);
            formData.append('Address', Address);
            formData.append('image', image);
            axios.post(MY_SERVER, formData)
              .then(response => {
                console.log(response.data);
                alert('Item created!');
                createItemForm.reset();
                load_data();
              })
              .catch(error => {
                console.error(error);
                alert('Item creation failed.');
              });
          });


        })
          .catch(error => {
            console.error(error);
          });
      }



      load_data()

    </script>
<script>
   function HideEditForm() {
            const Editform = document.querySelector('#edit-form');
            Editform.style.display = 'none';
          }
</script>


</body>

</html>


</body>

</html>